"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/socket";
exports.ids = ["pages/api/socket"];
exports.modules = {

/***/ "socket.io":
/*!****************************!*\
  !*** external "socket.io" ***!
  \****************************/
/***/ ((module) => {

module.exports = import("socket.io");;

/***/ }),

/***/ "(api)/./src/pages/api/socket.js":
/*!*********************************!*\
  !*** ./src/pages/api/socket.js ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var socket_io__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! socket.io */ \"socket.io\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([socket_io__WEBPACK_IMPORTED_MODULE_0__]);\nsocket_io__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (async (req, res)=>{\n    if (res.socket.server.io) {\n        res.end();\n        return;\n    }\n    const io = new socket_io__WEBPACK_IMPORTED_MODULE_0__.Server(res.socket.server, {\n        pingInterval: 10000,\n        pingTimeout: 5000\n    });\n    res.socket.server.io = io;\n    io.use((socket, next)=>{\n        setInterval(()=>{\n            socket.emit(\"ping\", \"pong\");\n        }, 1000);\n        next();\n    });\n    io.on(\"connection\", (socket)=>{\n        socket.join(\"global\");\n        socket.on(\"login\", async (data)=>{\n            const { username  } = data;\n            const allSockets = await io.fetchSockets();\n            const userSockets = allSockets.filter((s)=>s?.data?.user?.username === username);\n            if (userSockets.length > 0) return socket.emit(\"login\", {\n                error: \"Username already taken\"\n            });\n            const user = {\n                username\n            };\n            socket.data.user = user;\n            socket.emit(\"login\", {\n                success: true,\n                data: user\n            });\n        });\n        socket.on(\"fetchUser\", ()=>{\n            const user = socket.data.user;\n            if (user) {\n                socket.emit(\"user\", user);\n            } else {\n                socket.emit(\"user\", null);\n            }\n        });\n        socket.on(\"fetchRooms\", ()=>{\n            setInterval(async ()=>{\n                const rooms = io.sockets.adapter.rooms;\n                const allRooms = (await Promise.all(Object.keys(rooms).map(async (room)=>{\n                    const sockets = await io.in(room).fetchSockets();\n                    const users = sockets.map((s)=>s.data.user);\n                    return {\n                        id: room,\n                        name: rooms[room]?.name,\n                        owner: rooms[room]?.owner,\n                        passwordProtected: rooms[room]?.password ? true : false,\n                        maxUsers: rooms[room]?.maxUsers,\n                        users: users.length\n                    };\n                }))).filter((r)=>r.name !== \"global\");\n                socket.emit(\"rooms\", {\n                    isLogged: socket.data?.user !== undefined ? true : false,\n                    user: socket.data?.user,\n                    rooms: allRooms\n                });\n            }, 1000);\n        });\n        socket.on(\"createRoom\", (data)=>{\n            const { name , password  } = data;\n            if (!name) return socket.emit(\"createRoom\", {\n                success: false,\n                error: \"Name is required\"\n            });\n            if (io.sockets.adapter.rooms[name]) return socket.emit(\"createRoom\", {\n                success: false,\n                error: \"Room already exists\"\n            });\n            let room = {\n                id: Math.random().toString(36).substring(2, 9),\n                name: name.replace(/[^a-zA-Z0-9 ]/g, \"\"),\n                owner: socket.data.user,\n                users: 1,\n                maxUsers: 10\n            };\n            if (password) room.password = password;\n            io.sockets.adapter.rooms[room.id] = room;\n            socket.rooms.forEach((user_room)=>{\n                socket.leave(user_room);\n                updateMembers(user_room);\n                socket.to(user_room).emit(\"message\", {\n                    system: true,\n                    message: `${socket.data.user.username} left the room`\n                });\n            });\n            socket.join(room.id);\n            socket.emit(\"createRoom\", {\n                success: true,\n                data: room\n            });\n        });\n        socket.on(\"joinRoom\", async (data)=>{\n            const { id , password  } = data;\n            if (!id) return socket.emit(\"joinRoom\", {\n                success: false,\n                error: \"Room id is required\"\n            });\n            if (!io.sockets.adapter.rooms[id]) return socket.emit(\"joinRoom\", {\n                success: false,\n                error: \"Room not found\"\n            });\n            const room = io.sockets.adapter.rooms[id];\n            if (room.password && room.password !== password) return socket.emit(\"joinRoom\", {\n                success: false,\n                error: \"Wrong password\"\n            });\n            const sockets = await io.in(id).fetchSockets();\n            if (sockets.length >= room.maxUsers) return socket.emit(\"joinRoom\", {\n                success: false,\n                error: \"Room is full\"\n            });\n            if (sockets.find((s)=>s.data.user.username === socket.data.user.username)) return socket.emit(\"joinRoom\", {\n                success: false,\n                alreadyIn: true,\n                error: \"You are already in this room\"\n            });\n            socket.rooms.forEach((user_room)=>{\n                socket.leave(user_room);\n                updateMembers(user_room);\n                socket.to(user_room).emit(\"message\", {\n                    system: true,\n                    message: `${socket.data.user.username} left the room`\n                });\n            });\n            socket.join(id);\n            updateMembers(id);\n            socket.emit(\"joinRoom\", {\n                success: true,\n                data: room\n            });\n            socket.to(id).emit(\"message\", {\n                system: true,\n                message: `${socket.data.user.username} joined the room`\n            });\n        });\n        socket.on(\"leaveRoom\", async ()=>{\n            const room = Array.from(socket.rooms).find((room)=>room !== socket.id);\n            if (!room) return socket.emit(\"leaveRoom\", {\n                success: false,\n                error: \"You are not in a room\"\n            });\n            socket.leaveAll();\n            socket.join(\"global\");\n            socket.emit(\"leaveRoom\", {\n                success: true\n            });\n            updateMembers(room);\n            socket.to(room).emit(\"message\", {\n                system: true,\n                message: `${socket.data.user.username} left the room`\n            });\n        });\n        socket.on(\"roomMembers\", async ()=>{\n            const room = Array.from(socket.rooms).find((room)=>room !== socket.id);\n            if (!room) return socket.emit(\"roomMembers\", {\n                success: false,\n                error: \"You are not in a room\"\n            });\n            updateMembers(room);\n        });\n        function updateMembers(room) {\n            io.in(room).fetchSockets().then((sockets)=>{\n                const members = sockets.map((socket)=>socket.data.user);\n                if (members.length > 0) {\n                    io.in(room).emit(\"roomMembers\", {\n                        success: true,\n                        data: members\n                    });\n                } else {\n                    delete io.sockets.adapter.rooms[room];\n                }\n            });\n        }\n        socket.on(\"message\", async (data)=>{\n            const room = Array.from(socket.rooms).find((room)=>room !== socket.id);\n            if (!room) return;\n            const message = {\n                user: socket.data.user,\n                message: data.message,\n                date: new Date()\n            };\n            const sockets = await io.in(room).fetchSockets();\n            sockets.forEach((s)=>{\n                s.emit(\"message\", {\n                    ...message,\n                    self: s.id === socket.id\n                });\n            });\n        });\n        socket.on(\"fetchRoom\", async ()=>{\n            const room = Array.from(socket.rooms).find((room)=>room !== socket.id);\n            if (!room) return socket.emit(\"fetchRoom\", {\n                success: false,\n                error: \"You are not in a room\"\n            });\n            socket.emit(\"fetchRoom\", {\n                success: true,\n                data: io.sockets.adapter.rooms[room]\n            });\n        });\n        socket.on(\"disconnect\", (data)=>{\n            socket.rooms.forEach((room)=>{\n                socket.to(room).emit(\"message\", {\n                    system: true,\n                    message: `${socket.data.user.username} left the room`\n                });\n                updateMembers(room);\n            });\n            socket.leaveAll();\n        });\n    });\n    res.end();\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Y2VzIjpbIndlYnBhY2s6Ly9uZXh0anMtY2hhdC8uL3NyYy9wYWdlcy9hcGkvc29ja2V0LmpzPzJkYjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2VydmVyIH0gZnJvbSBcInNvY2tldC5pb1wiO1xuXG5leHBvcnQgZGVmYXVsdCAoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGlmIChyZXMuc29ja2V0LnNlcnZlci5pbykge1xuICAgIHJlcy5lbmQoKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBpbyA9IG5ldyBTZXJ2ZXIocmVzLnNvY2tldC5zZXJ2ZXIsIHtcbiAgICBwaW5nSW50ZXJ2YWw6IDEwMDAwLFxuICAgIHBpbmdUaW1lb3V0OiA1MDAwXG4gIH0pO1xuICByZXMuc29ja2V0LnNlcnZlci5pbyA9IGlvO1xuXG4gIGlvLnVzZSgoc29ja2V0LCBuZXh0KSA9PiB7XG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgc29ja2V0LmVtaXQoXCJwaW5nXCIsIFwicG9uZ1wiKTtcbiAgICB9LCAxMDAwKTtcbiAgICBuZXh0KCk7XG4gIH0pO1xuXG4gIGlvLm9uKFwiY29ubmVjdGlvblwiLCAoc29ja2V0KSA9PiB7XG4gICAgc29ja2V0LmpvaW4oJ2dsb2JhbCcpO1xuXG4gICAgc29ja2V0Lm9uKFwibG9naW5cIiwgYXN5bmMgKGRhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgdXNlcm5hbWUgfSA9IGRhdGE7XG5cbiAgICAgIGNvbnN0IGFsbFNvY2tldHMgPSBhd2FpdCBpby5mZXRjaFNvY2tldHMoKTtcbiAgICAgIGNvbnN0IHVzZXJTb2NrZXRzID0gYWxsU29ja2V0cy5maWx0ZXIoKHMpID0+IHM/LmRhdGE/LnVzZXI/LnVzZXJuYW1lID09PSB1c2VybmFtZSk7XG5cbiAgICAgIGlmICh1c2VyU29ja2V0cy5sZW5ndGggPiAwKSByZXR1cm4gc29ja2V0LmVtaXQoXCJsb2dpblwiLCB7IGVycm9yOiBcIlVzZXJuYW1lIGFscmVhZHkgdGFrZW5cIiB9KTtcblxuICAgICAgY29uc3QgdXNlciA9IHtcbiAgICAgICAgdXNlcm5hbWVcbiAgICAgIH07XG5cbiAgICAgIHNvY2tldC5kYXRhLnVzZXIgPSB1c2VyO1xuICAgICAgc29ja2V0LmVtaXQoXCJsb2dpblwiLCB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHVzZXJcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgc29ja2V0Lm9uKFwiZmV0Y2hVc2VyXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBzb2NrZXQuZGF0YS51c2VyO1xuICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgc29ja2V0LmVtaXQoXCJ1c2VyXCIsIHVzZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc29ja2V0LmVtaXQoXCJ1c2VyXCIsIG51bGwpO1xuICAgICAgfVxuICAgIH0pXG5cbiAgICBzb2NrZXQub24oXCJmZXRjaFJvb21zXCIsICgpID0+IHtcbiAgICAgIHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgcm9vbXMgPSBpby5zb2NrZXRzLmFkYXB0ZXIucm9vbXM7XG4gICAgICAgIGNvbnN0IGFsbFJvb21zID0gKGF3YWl0IFByb21pc2UuYWxsKE9iamVjdC5rZXlzKHJvb21zKS5tYXAoYXN5bmMgKHJvb20pID0+IHtcbiAgICAgICAgICBjb25zdCBzb2NrZXRzID0gYXdhaXQgaW8uaW4ocm9vbSkuZmV0Y2hTb2NrZXRzKCk7XG4gICAgICAgICAgY29uc3QgdXNlcnMgPSBzb2NrZXRzLm1hcCgocykgPT4gcy5kYXRhLnVzZXIpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogcm9vbSxcbiAgICAgICAgICAgIG5hbWU6IHJvb21zW3Jvb21dPy5uYW1lLFxuICAgICAgICAgICAgb3duZXI6IHJvb21zW3Jvb21dPy5vd25lcixcbiAgICAgICAgICAgIHBhc3N3b3JkUHJvdGVjdGVkOiByb29tc1tyb29tXT8ucGFzc3dvcmQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBtYXhVc2Vyczogcm9vbXNbcm9vbV0/Lm1heFVzZXJzLFxuICAgICAgICAgICAgdXNlcnM6IHVzZXJzLmxlbmd0aFxuICAgICAgICAgIH07XG4gICAgICAgIH0pKSkuZmlsdGVyKChyKSA9PiByLm5hbWUgIT09ICdnbG9iYWwnKTtcbiAgICAgICAgc29ja2V0LmVtaXQoXCJyb29tc1wiLCB7XG4gICAgICAgICAgaXNMb2dnZWQ6IHNvY2tldC5kYXRhPy51c2VyICE9PSB1bmRlZmluZWQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgdXNlcjogc29ja2V0LmRhdGE/LnVzZXIsXG4gICAgICAgICAgcm9vbXM6IGFsbFJvb21zXG4gICAgICAgIH0pO1xuICAgICAgfSwgMTAwMCk7XG4gICAgfSk7XG5cbiAgICBzb2NrZXQub24oXCJjcmVhdGVSb29tXCIsIGRhdGEgPT4ge1xuICAgICAgY29uc3QgeyBuYW1lLCBwYXNzd29yZCB9ID0gZGF0YTtcbiAgICAgIGlmICghbmFtZSkgcmV0dXJuIHNvY2tldC5lbWl0KFwiY3JlYXRlUm9vbVwiLCB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJOYW1lIGlzIHJlcXVpcmVkXCIgfSk7XG4gICAgICBpZiAoaW8uc29ja2V0cy5hZGFwdGVyLnJvb21zW25hbWVdKSByZXR1cm4gc29ja2V0LmVtaXQoXCJjcmVhdGVSb29tXCIsIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlJvb20gYWxyZWFkeSBleGlzdHNcIiB9KTtcbiAgICAgIGxldCByb29tID0ge1xuICAgICAgICBpZDogTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpLFxuICAgICAgICBuYW1lOiBuYW1lLnJlcGxhY2UoL1teYS16QS1aMC05IF0vZywgXCJcIiksXG4gICAgICAgIG93bmVyOiBzb2NrZXQuZGF0YS51c2VyLFxuICAgICAgICB1c2VyczogMSxcbiAgICAgICAgbWF4VXNlcnM6IDEwXG4gICAgICB9O1xuXG4gICAgICBpZiAocGFzc3dvcmQpIHJvb20ucGFzc3dvcmQgPSBwYXNzd29yZDtcblxuXG4gICAgICBpby5zb2NrZXRzLmFkYXB0ZXIucm9vbXNbcm9vbS5pZF0gPSByb29tO1xuXG4gICAgICBzb2NrZXQucm9vbXMuZm9yRWFjaCgodXNlcl9yb29tKSA9PiB7XG4gICAgICAgIHNvY2tldC5sZWF2ZSh1c2VyX3Jvb20pO1xuICAgICAgICB1cGRhdGVNZW1iZXJzKHVzZXJfcm9vbSk7XG4gICAgICAgIHNvY2tldC50byh1c2VyX3Jvb20pLmVtaXQoXCJtZXNzYWdlXCIsIHtcbiAgICAgICAgICBzeXN0ZW06IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogYCR7c29ja2V0LmRhdGEudXNlci51c2VybmFtZX0gbGVmdCB0aGUgcm9vbWBcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHNvY2tldC5qb2luKHJvb20uaWQpO1xuICAgICAgc29ja2V0LmVtaXQoXCJjcmVhdGVSb29tXCIsIHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogcm9vbSB9KTtcbiAgICB9KVxuXG4gICAgc29ja2V0Lm9uKFwiam9pblJvb21cIiwgYXN5bmMgZGF0YSA9PiB7XG4gICAgICBjb25zdCB7IGlkLCBwYXNzd29yZCB9ID0gZGF0YTtcbiAgICAgIGlmICghaWQpIHJldHVybiBzb2NrZXQuZW1pdChcImpvaW5Sb29tXCIsIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlJvb20gaWQgaXMgcmVxdWlyZWRcIiB9KTtcbiAgICAgIGlmICghaW8uc29ja2V0cy5hZGFwdGVyLnJvb21zW2lkXSkgcmV0dXJuIHNvY2tldC5lbWl0KFwiam9pblJvb21cIiwgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiUm9vbSBub3QgZm91bmRcIiB9KTtcblxuICAgICAgY29uc3Qgcm9vbSA9IGlvLnNvY2tldHMuYWRhcHRlci5yb29tc1tpZF07XG4gICAgICBpZiAocm9vbS5wYXNzd29yZCAmJiByb29tLnBhc3N3b3JkICE9PSBwYXNzd29yZCkgcmV0dXJuIHNvY2tldC5lbWl0KFwiam9pblJvb21cIiwgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiV3JvbmcgcGFzc3dvcmRcIiB9KTtcbiAgICAgIGNvbnN0IHNvY2tldHMgPSBhd2FpdCBpby5pbihpZCkuZmV0Y2hTb2NrZXRzKCk7XG4gICAgICBpZiAoc29ja2V0cy5sZW5ndGggPj0gcm9vbS5tYXhVc2VycykgcmV0dXJuIHNvY2tldC5lbWl0KFwiam9pblJvb21cIiwgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiUm9vbSBpcyBmdWxsXCIgfSk7XG4gICAgICBpZiAoc29ja2V0cy5maW5kKChzKSA9PiBzLmRhdGEudXNlci51c2VybmFtZSA9PT0gc29ja2V0LmRhdGEudXNlci51c2VybmFtZSkpIHJldHVybiBzb2NrZXQuZW1pdChcImpvaW5Sb29tXCIsIHsgc3VjY2VzczogZmFsc2UsIGFscmVhZHlJbjogdHJ1ZSwgZXJyb3I6IFwiWW91IGFyZSBhbHJlYWR5IGluIHRoaXMgcm9vbVwiIH0pO1xuXG4gICAgICBzb2NrZXQucm9vbXMuZm9yRWFjaCgodXNlcl9yb29tKSA9PiB7XG4gICAgICAgIHNvY2tldC5sZWF2ZSh1c2VyX3Jvb20pO1xuICAgICAgICB1cGRhdGVNZW1iZXJzKHVzZXJfcm9vbSk7XG4gICAgICAgIHNvY2tldC50byh1c2VyX3Jvb20pLmVtaXQoXCJtZXNzYWdlXCIsIHtcbiAgICAgICAgICBzeXN0ZW06IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogYCR7c29ja2V0LmRhdGEudXNlci51c2VybmFtZX0gbGVmdCB0aGUgcm9vbWBcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgc29ja2V0LmpvaW4oaWQpO1xuXG4gICAgICB1cGRhdGVNZW1iZXJzKGlkKTtcbiAgICAgIHNvY2tldC5lbWl0KFwiam9pblJvb21cIiwgeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByb29tIH0pO1xuICAgICAgc29ja2V0LnRvKGlkKS5lbWl0KFwibWVzc2FnZVwiLCB7XG4gICAgICAgIHN5c3RlbTogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogYCR7c29ja2V0LmRhdGEudXNlci51c2VybmFtZX0gam9pbmVkIHRoZSByb29tYFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBzb2NrZXQub24oXCJsZWF2ZVJvb21cIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgcm9vbSA9IEFycmF5LmZyb20oc29ja2V0LnJvb21zKS5maW5kKHJvb20gPT4gcm9vbSAhPT0gc29ja2V0LmlkKTtcbiAgICAgIGlmICghcm9vbSkgcmV0dXJuIHNvY2tldC5lbWl0KFwibGVhdmVSb29tXCIsIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIllvdSBhcmUgbm90IGluIGEgcm9vbVwiIH0pO1xuICAgICAgc29ja2V0LmxlYXZlQWxsKCk7XG4gICAgICBzb2NrZXQuam9pbihcImdsb2JhbFwiKTtcbiAgICAgIHNvY2tldC5lbWl0KFwibGVhdmVSb29tXCIsIHsgc3VjY2VzczogdHJ1ZSB9KTtcblxuICAgICAgdXBkYXRlTWVtYmVycyhyb29tKTtcbiAgICAgIHNvY2tldC50byhyb29tKS5lbWl0KFwibWVzc2FnZVwiLCB7XG4gICAgICAgIHN5c3RlbTogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogYCR7c29ja2V0LmRhdGEudXNlci51c2VybmFtZX0gbGVmdCB0aGUgcm9vbWBcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgc29ja2V0Lm9uKFwicm9vbU1lbWJlcnNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgcm9vbSA9IEFycmF5LmZyb20oc29ja2V0LnJvb21zKS5maW5kKHJvb20gPT4gcm9vbSAhPT0gc29ja2V0LmlkKTtcbiAgICAgIGlmICghcm9vbSkgcmV0dXJuIHNvY2tldC5lbWl0KFwicm9vbU1lbWJlcnNcIiwgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGFyZSBub3QgaW4gYSByb29tXCIgfSk7XG5cbiAgICAgIHVwZGF0ZU1lbWJlcnMocm9vbSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiB1cGRhdGVNZW1iZXJzKHJvb20pIHtcbiAgICAgIGlvLmluKHJvb20pLmZldGNoU29ja2V0cygpLnRoZW4oc29ja2V0cyA9PiB7XG4gICAgICAgIGNvbnN0IG1lbWJlcnMgPSBzb2NrZXRzLm1hcChzb2NrZXQgPT4gc29ja2V0LmRhdGEudXNlcik7XG4gICAgICAgIGlmIChtZW1iZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBpby5pbihyb29tKS5lbWl0KFwicm9vbU1lbWJlcnNcIiwgeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBtZW1iZXJzIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRlbGV0ZSBpby5zb2NrZXRzLmFkYXB0ZXIucm9vbXNbcm9vbV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHNvY2tldC5vbihcIm1lc3NhZ2VcIiwgYXN5bmMgZGF0YSA9PiB7XG4gICAgICBjb25zdCByb29tID0gQXJyYXkuZnJvbShzb2NrZXQucm9vbXMpLmZpbmQocm9vbSA9PiByb29tICE9PSBzb2NrZXQuaWQpO1xuICAgICAgaWYgKCFyb29tKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSB7XG4gICAgICAgIHVzZXI6IHNvY2tldC5kYXRhLnVzZXIsXG4gICAgICAgIG1lc3NhZ2U6IGRhdGEubWVzc2FnZSxcbiAgICAgICAgZGF0ZTogbmV3IERhdGUoKVxuICAgICAgfTtcblxuICAgICAgY29uc3Qgc29ja2V0cyA9IGF3YWl0IGlvLmluKHJvb20pLmZldGNoU29ja2V0cygpO1xuICAgICAgc29ja2V0cy5mb3JFYWNoKHMgPT4ge1xuICAgICAgICBzLmVtaXQoXCJtZXNzYWdlXCIsIHtcbiAgICAgICAgICAuLi5tZXNzYWdlLFxuICAgICAgICAgIHNlbGY6IHMuaWQgPT09IHNvY2tldC5pZFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgc29ja2V0Lm9uKFwiZmV0Y2hSb29tXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJvb20gPSBBcnJheS5mcm9tKHNvY2tldC5yb29tcykuZmluZChyb29tID0+IHJvb20gIT09IHNvY2tldC5pZCk7XG4gICAgICBpZiAoIXJvb20pIHJldHVybiBzb2NrZXQuZW1pdChcImZldGNoUm9vbVwiLCB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJZb3UgYXJlIG5vdCBpbiBhIHJvb21cIiB9KTtcblxuICAgICAgc29ja2V0LmVtaXQoXCJmZXRjaFJvb21cIiwgeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBpby5zb2NrZXRzLmFkYXB0ZXIucm9vbXNbcm9vbV0gfSk7XG4gICAgfSk7XG5cblxuXG4gICAgc29ja2V0Lm9uKFwiZGlzY29ubmVjdFwiLCAoZGF0YSkgPT4ge1xuICAgICAgc29ja2V0LnJvb21zLmZvckVhY2gocm9vbSA9PiB7XG4gICAgICAgIHNvY2tldC50byhyb29tKS5lbWl0KFwibWVzc2FnZVwiLCB7XG4gICAgICAgICAgc3lzdGVtOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IGAke3NvY2tldC5kYXRhLnVzZXIudXNlcm5hbWV9IGxlZnQgdGhlIHJvb21gXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHVwZGF0ZU1lbWJlcnMocm9vbSk7XG4gICAgICB9KTtcbiAgICAgIHNvY2tldC5sZWF2ZUFsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICByZXMuZW5kKCk7XG5cbn0pOyJdLCJuYW1lcyI6WyJTZXJ2ZXIiLCJyZXEiLCJyZXMiLCJzb2NrZXQiLCJzZXJ2ZXIiLCJpbyIsImVuZCIsInBpbmdJbnRlcnZhbCIsInBpbmdUaW1lb3V0IiwidXNlIiwibmV4dCIsInNldEludGVydmFsIiwiZW1pdCIsIm9uIiwiam9pbiIsImRhdGEiLCJ1c2VybmFtZSIsImFsbFNvY2tldHMiLCJmZXRjaFNvY2tldHMiLCJ1c2VyU29ja2V0cyIsImZpbHRlciIsInMiLCJ1c2VyIiwibGVuZ3RoIiwiZXJyb3IiLCJzdWNjZXNzIiwicm9vbXMiLCJzb2NrZXRzIiwiYWRhcHRlciIsImFsbFJvb21zIiwiUHJvbWlzZSIsImFsbCIsIk9iamVjdCIsImtleXMiLCJtYXAiLCJyb29tIiwiaW4iLCJ1c2VycyIsImlkIiwibmFtZSIsIm93bmVyIiwicGFzc3dvcmRQcm90ZWN0ZWQiLCJwYXNzd29yZCIsIm1heFVzZXJzIiwiciIsImlzTG9nZ2VkIiwidW5kZWZpbmVkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwicmVwbGFjZSIsImZvckVhY2giLCJ1c2VyX3Jvb20iLCJsZWF2ZSIsInVwZGF0ZU1lbWJlcnMiLCJ0byIsInN5c3RlbSIsIm1lc3NhZ2UiLCJmaW5kIiwiYWxyZWFkeUluIiwiQXJyYXkiLCJmcm9tIiwibGVhdmVBbGwiLCJ0aGVuIiwibWVtYmVycyIsImRhdGUiLCJEYXRlIiwic2VsZiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/socket.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./src/pages/api/socket.js"));
module.exports = __webpack_exports__;

})();